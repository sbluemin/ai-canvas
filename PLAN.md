# Issue #29 êµ¬í˜„ ê³„íš: íŒŒì¼ ì²¨ë¶€ ë° ì´ë¯¸ì§€ ì§€ì›

## ê°œìš”
ChatPanelì˜ PlusIcon ë²„íŠ¼ì— íŒŒì¼ ì²¨ë¶€ ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ì—¬, ì‚¬ìš©ìê°€ ì´ë¯¸ì§€/PDFë¥¼ AI ì±„íŒ…ì— ì²¨ë¶€í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.

---

## Step 1: íƒ€ì… ì •ì˜ í™•ì¥

### ìˆ˜ì • íŒŒì¼
- `src/types/chat.ts` â€” `Attachment` ì¸í„°í˜ì´ìŠ¤ ì¶”ê°€
- `src/store/types.ts` â€” `Message` ì¸í„°í˜ì´ìŠ¤ì— `attachments` í•„ë“œ ì¶”ê°€
- `electron/ai/types.ts` â€” `AiChatRequest`ì— `attachments` í•„ë“œ ì¶”ê°€

### ìƒì„¸ ë‚´ìš©
```typescript
// src/types/chat.ts
export interface Attachment {
  id: string;
  type: 'image' | 'pdf';
  fileName: string;
  mimeType: string;        // 'image/png', 'image/jpeg', 'image/gif', 'image/webp', 'application/pdf'
  base64: string;           // base64 ì¸ì½”ë”©ëœ íŒŒì¼ ë°ì´í„°
  thumbnailBase64?: string; // í”„ë¦¬ë·°ìš© ì¸ë„¤ì¼ (ì´ë¯¸ì§€ì¸ ê²½ìš° ì›ë³¸ ì‚¬ìš©)
  size: number;             // íŒŒì¼ í¬ê¸° (bytes)
}
```

`Message.attachments?: Attachment[]` ì¶”ê°€, `ChatHistory`ì—ë„ ë™ì¼ ì ìš©.
`AiChatRequest.attachments?: { type, fileName, mimeType, base64 }[]` ì¶”ê°€.

---

## Step 2: íŒŒì¼ ì„ íƒ IPC í•¸ë“¤ëŸ¬ ì¶”ê°€ (Electron)

### ìˆ˜ì • íŒŒì¼
- `electron/ipc/dialog.ts` â€” íŒŒì¼ ì²¨ë¶€ìš© ë‹¤ì´ì–¼ë¡œê·¸ í•¸ë“¤ëŸ¬ ì¶”ê°€
- `electron/preload.ts` â€” `showAttachFileDialog` IPC ë¸Œë¦¿ì§€ ë…¸ì¶œ

### ìƒì„¸ ë‚´ìš©
- `dialog.showOpenDialog`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ì§€/PDF íŒŒì¼ ì„ íƒ ë‹¤ì´ì–¼ë¡œê·¸ êµ¬í˜„
- í•„í„°: `['png', 'jpg', 'jpeg', 'gif', 'webp', 'pdf']`
- ì„ íƒëœ íŒŒì¼ì„ ì½ê³  base64ë¡œ ë³€í™˜í•˜ì—¬ ë°˜í™˜
- ìµœëŒ€ íŒŒì¼ í¬ê¸° ì œí•œ (ì˜ˆ: 10MB)

---

## Step 3: í”„ë¡ íŠ¸ì—”ë“œ API í™•ì¥

### ìˆ˜ì • íŒŒì¼
- `src/api/index.ts` â€” `showAttachFileDialog()` API ë©”ì„œë“œ ì¶”ê°€, `chat()` ë©”ì„œë“œì— attachments ì „ë‹¬

### ìƒì„¸ ë‚´ìš©
```typescript
async showAttachFileDialog(): Promise<{ success: boolean; attachment?: Attachment; error?: string }>
```
- Electron í™˜ê²½ì—ì„œëŠ” IPC í˜¸ì¶œ
- Web í™˜ê²½ì—ì„œëŠ” `<input type="file">` í´ë°± (File API ì‚¬ìš©)

`api.chat()`ì˜ ì˜µì…˜ì— `attachments` ì „ë‹¬.

---

## Step 4: ChatPanel UI â€” íŒŒì¼ ì²¨ë¶€ ê¸°ëŠ¥

### ìˆ˜ì • íŒŒì¼
- `src/components/ChatPanel.tsx` â€” PlusIcon í•¸ë“¤ëŸ¬, ì²¨ë¶€ í”„ë¦¬ë·° UI
- `src/components/ChatPanel.css` â€” ì²¨ë¶€ í”„ë¦¬ë·° ìŠ¤íƒ€ì¼ë§

### ìƒì„¸ ë‚´ìš©

**4-1. PlusIcon í´ë¦­ í•¸ë“¤ëŸ¬:**
- í´ë¦­ ì‹œ `api.showAttachFileDialog()` í˜¸ì¶œ
- ì„ íƒëœ íŒŒì¼ì„ ë¡œì»¬ ìƒíƒœ(`attachments`)ì— ì¶”ê°€
- ë‹¤ì¤‘ ì²¨ë¶€ ì§€ì› (PlusIcon ë°˜ë³µ í´ë¦­)

**4-2. ì²¨ë¶€ í”„ë¦¬ë·° ì˜ì—­ (input ìœ„ì— í‘œì‹œ):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ğŸ–¼ image.png âœ•] [ğŸ“„ doc.pdf âœ•] â”‚  â† ì²¨ë¶€ í”„ë¦¬ë·°
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [+] Type a message...    [ğŸ¤][â¤]â”‚  â† ê¸°ì¡´ ì…ë ¥ì°½
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
- ì´ë¯¸ì§€: ì‘ì€ ì¸ë„¤ì¼ í”„ë¦¬ë·° + íŒŒì¼ëª… + ì‚­ì œ(âœ•) ë²„íŠ¼
- PDF: íŒŒì¼ ì•„ì´ì½˜ + íŒŒì¼ëª… + ì‚­ì œ(âœ•) ë²„íŠ¼
- ê°€ë¡œ ìŠ¤í¬ë¡¤ë¡œ ë‹¤ì¤‘ ì²¨ë¶€ í‘œì‹œ

**4-3. Drag & Drop ì§€ì›:**
- input-wrapper ì˜ì—­ì— drag/drop ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì¶”ê°€
- ë“œë˜ê·¸ ì¤‘ ì‹œê°ì  í”¼ë“œë°± (ì ì„  í…Œë‘ë¦¬ ë“±)
- ë“œë¡­ ì‹œ íŒŒì¼ ì½ê¸° â†’ attachments ìƒíƒœì— ì¶”ê°€

**4-4. ì „ì†¡ ì²˜ë¦¬:**
- `handleSubmit`ì—ì„œ attachmentsë¥¼ sendMessageì— ì „ë‹¬
- ì „ì†¡ í›„ ë¡œì»¬ attachments ìƒíƒœ ì´ˆê¸°í™”

---

## Step 5: ë©”ì‹œì§€ ë Œë”ë§ì— ì²¨ë¶€ íŒŒì¼ í‘œì‹œ

### ìˆ˜ì • íŒŒì¼
- `src/components/ChatPanel.tsx` â€” ë©”ì‹œì§€ ë Œë”ë§ ë¶€ë¶„
- `src/components/ChatPanel.css` â€” ì²¨ë¶€ ì´ë¯¸ì§€/íŒŒì¼ ìŠ¤íƒ€ì¼

### ìƒì„¸ ë‚´ìš©
- user ë©”ì‹œì§€ì— `msg.attachments`ê°€ ìˆìœ¼ë©´ ì´ë¯¸ì§€ ì¸ë„¤ì¼/íŒŒì¼ ì•„ì´ì½˜ í‘œì‹œ
- ì´ë¯¸ì§€ í´ë¦­ ì‹œ í™•ëŒ€ ë³´ê¸° (ê°„ë‹¨í•œ ëª¨ë‹¬ ë˜ëŠ” ìƒˆ íƒ­)
- íŒŒì¼ëª…ê³¼ í¬ê¸° ì •ë³´ í‘œì‹œ

---

## Step 6: useChatRequest í›… í™•ì¥

### ìˆ˜ì • íŒŒì¼
- `src/hooks/useChatRequest.ts` â€” sendMessageì— attachments íŒŒë¼ë¯¸í„° ì¶”ê°€

### ìƒì„¸ ë‚´ìš©
- `sendMessage(prompt, options)` â†’ optionsì— `attachments` ì¶”ê°€
- `addMessage` í˜¸ì¶œ ì‹œ attachments í¬í•¨
- `api.chat()` í˜¸ì¶œ ì‹œ attachments ì „ë‹¬
- historyì— ì²¨ë¶€ ì •ë³´ í¬í•¨ (base64ëŠ” ì œì™¸í•˜ê³  íŒŒì¼ëª…ë§Œ í¬í•¨í•˜ì—¬ íˆìŠ¤í† ë¦¬ í¬ê¸° ê´€ë¦¬)

---

## Step 7: Store (chatSlice) í™•ì¥

### ìˆ˜ì • íŒŒì¼
- `src/store/slices/chatSlice.ts` â€” addMessageì— attachments ì§€ì›

### ìƒì„¸ ë‚´ìš©
- `addMessage(role, content, provider?, attachments?)` ì‹œê·¸ë‹ˆì²˜ í™•ì¥
- Message ìƒì„± ì‹œ attachments í¬í•¨

---

## Step 8: Electron AI ì›Œí¬í”Œë¡œìš°ì— ì²¨ë¶€ íŒŒì¼ ì „ë‹¬

### ìˆ˜ì • íŒŒì¼
- `electron/ai/workflow.ts` â€” attachmentsë¥¼ í”„ë¡¬í”„íŠ¸ì— í¬í•¨
- `electron/ai/providerAdapter.ts` â€” ë©€í‹°ëª¨ë‹¬ ë©”ì‹œì§€ í¬ë§· êµ¬ì„±
- `electron/prompts/system.ts` â€” ì²¨ë¶€ íŒŒì¼ ì»¨í…ìŠ¤íŠ¸ ì•ˆë‚´ ì¶”ê°€

### ìƒì„¸ ë‚´ìš©
- workflowì—ì„œ request.attachmentsë¥¼ ë°›ì•„ callProviderì— ì „ë‹¬
- providerAdapterì—ì„œ OpenCode ë°±ì—”ë“œì— ë©€í‹°ëª¨ë‹¬ í¬ë§·ìœ¼ë¡œ ì „ë‹¬
  - ì´ë¯¸ì§€: base64 ë°ì´í„°ë¥¼ ë©€í‹°ëª¨ë‹¬ ë©”ì‹œì§€ í¬ë§·ìœ¼ë¡œ ë³€í™˜
  - PDF: í…ìŠ¤íŠ¸ ì¶”ì¶œ ë˜ëŠ” ì´ë¯¸ì§€ ë³€í™˜ í›„ ì „ë‹¬
- ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ì— "ì²¨ë¶€ëœ ì´ë¯¸ì§€/íŒŒì¼ì´ ìˆìŠµë‹ˆë‹¤" ì»¨í…ìŠ¤íŠ¸ ì¶”ê°€

---

## Step 9: ì—ì…‹ ë””ë ‰í† ë¦¬ ê´€ë¦¬

### ìˆ˜ì • íŒŒì¼
- `electron/ipc/project.ts` â€” ê¸°ì¡´ `saveImageAsset` í™œìš© ë˜ëŠ” í™•ì¥

### ìƒì„¸ ë‚´ìš©
- ì´ë¯¸ `api.saveImageAsset(projectPath, base64, mimeType)` ì¡´ì¬
- ì²¨ë¶€ íŒŒì¼ì„ `.ai-canvas/assets/` ë””ë ‰í† ë¦¬ì— ì €ì¥
- ì €ì¥ëœ ê²½ë¡œë¥¼ ë°˜í™˜í•˜ì—¬ ë‚˜ì¤‘ì— ì°¸ì¡° ê°€ëŠ¥
- ëŒ€í™” ì„¸ì…˜ ì €ì¥ ì‹œ attachmentì˜ base64 ëŒ€ì‹  asset ê²½ë¡œ ì°¸ì¡°ë¡œ ì „í™˜ (ì €ì¥ ìµœì í™”)

---

## Step 10: ì±„íŒ… ì„¸ì…˜ ì§ë ¬í™”/ì—­ì§ë ¬í™”

### ìˆ˜ì • íŒŒì¼
- `src/components/ChatPanel.tsx` â€” ì„¸ì…˜ ì €ì¥ ì‹œ attachment ì§ë ¬í™”
- ì„¸ì…˜ ë¡œë“œ ì‹œ attachment ì—­ì§ë ¬í™”

### ìƒì„¸ ë‚´ìš©
- ì €ì¥: attachmentsì˜ base64ë¥¼ ì—ì…‹ ë””ë ‰í† ë¦¬ì— ì €ì¥í•˜ê³  ê²½ë¡œë§Œ ì§ë ¬í™”
- ë¡œë“œ: ì €ì¥ëœ ê²½ë¡œì—ì„œ base64ë¥¼ ë‹¤ì‹œ ë¡œë“œ
- ë˜ëŠ” ë‹¨ìˆœí™”í•˜ì—¬ base64ë¥¼ ê·¸ëŒ€ë¡œ ì €ì¥ (ì²« ë²ˆì§¸ ë²„ì „)

---

## êµ¬í˜„ ìˆœì„œ ë° ìš°ì„ ìˆœìœ„

| ìˆœì„œ | ë‹¨ê³„ | ì„¤ëª… |
|------|------|------|
| 1 | Step 1 | íƒ€ì… ì •ì˜ â€” ëª¨ë“  ì‘ì—…ì˜ ê¸°ë°˜ |
| 2 | Step 2 + 3 | IPC í•¸ë“¤ëŸ¬ + í”„ë¡ íŠ¸ì—”ë“œ API â€” íŒŒì¼ ì„ íƒ ì¸í”„ë¼ |
| 3 | Step 7 | Store í™•ì¥ â€” ì²¨ë¶€ ë°ì´í„° ì €ì¥ êµ¬ì¡° |
| 4 | Step 4 | ChatPanel UI â€” í•µì‹¬ ì‚¬ìš©ì ê²½í—˜ |
| 5 | Step 5 | ë©”ì‹œì§€ ë Œë”ë§ â€” ì „ì†¡ëœ ì²¨ë¶€ í‘œì‹œ |
| 6 | Step 6 | useChatRequest â€” ì²¨ë¶€ ì „ì†¡ ë¡œì§ |
| 7 | Step 8 | AI ì›Œí¬í”Œë¡œìš° â€” ë©€í‹°ëª¨ë‹¬ ì „ë‹¬ |
| 8 | Step 9 + 10 | ì—ì…‹ ê´€ë¦¬ + ì„¸ì…˜ ì§ë ¬í™” â€” ë°ì´í„° ì˜ì†ì„± |

---

## ì§€ì› íŒŒì¼ í˜•ì‹

| í˜•ì‹ | MIME Type | í”„ë¦¬ë·° |
|------|-----------|--------|
| PNG | image/png | ì¸ë„¤ì¼ |
| JPEG | image/jpeg | ì¸ë„¤ì¼ |
| GIF | image/gif | ì¸ë„¤ì¼ |
| WebP | image/webp | ì¸ë„¤ì¼ |
| PDF | application/pdf | íŒŒì¼ ì•„ì´ì½˜ |

## íŒŒì¼ í¬ê¸° ì œí•œ
- ë‹¨ì¼ íŒŒì¼: ìµœëŒ€ 10MB
- ì´ ì²¨ë¶€: ìµœëŒ€ 20MB (ëŒ€í™”ë‹¹)

---

## ë¹„ê³ 
- í˜„ì¬ AI ë°±ì—”ë“œëŠ” OpenCodeë¥¼ í†µí•´ ë¼ìš°íŒ…ë˜ë¯€ë¡œ, ë©€í‹°ëª¨ë‹¬ ì§€ì›ì€ OpenCode ë°±ì—”ë“œì˜ ë©€í‹°ëª¨ë‹¬ API ì§€ì› ì—¬ë¶€ì— ì˜ì¡´í•©ë‹ˆë‹¤.
- ì²« ë²ˆì§¸ ë²„ì „ì—ì„œëŠ” í”„ë¡ íŠ¸ì—”ë“œ UIì™€ IPC ì¸í”„ë¼ë¥¼ ë¨¼ì € êµ¬ì¶•í•˜ê³ , ë°±ì—”ë“œ ë©€í‹°ëª¨ë‹¬ ì „ë‹¬ì€ OpenCode API ìŠ¤í™ì— ë§ì¶° ì¡°ì •í•©ë‹ˆë‹¤.
- ì´ë¯¸ ì¡´ì¬í•˜ëŠ” `saveImageAsset` APIë¥¼ ìµœëŒ€í•œ í™œìš©í•˜ì—¬ ì—ì…‹ ê´€ë¦¬ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.
